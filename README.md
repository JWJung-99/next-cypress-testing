# Next.js + Cypress ν…μ¤ν… μ‹¤μµ

## 1. ν”„λ΅ νΈμ—”λ“ ν…μ¤ν…

### μ™ ν…μ¤νΈ μ½”λ“κ°€ ν•„μ”ν• κΉ?

- λ¨λ“  μ‹μ¤ν…μ„ μ‚¬λμ΄ μΌμΌμ΄ μ§μ ‘ ν…μ¤νΈν•λ” κ²ƒμ€ λ¶κ°€λ¥ν•λ‹¤.
- κ·λ¨κ°€ μ‘μ€ μ‹μ¤ν…μ€ ν…μ¤ν…μ΄ ν•„μ” μ—†μ„ μλ„ μμ§€λ§, κ·λ¨κ°€ μ»¤μ§μλ΅ ν…μ¤νΈν•  μ μλ” λ²”μ„μ ν•κ³„μ™€ ν…μ¤νΈ μ‹κ°„μ΄ λμ–΄λ‚λ‹¤.

### λ¬΄μ—‡μ„ ν…μ¤νΈ ν•΄μ•Όν• κΉ?

- Front-end κ°λ°μλ” μ‚¬μ©μ κ΄€μ μ μΈν„°λ ‰μ…κ³Ό κΈ°λ¥ λ™μ‘μ„ ν…μ¤νΈ ν•΄μ•Όν•λ‹¤.

### μ–΄λ–»κ² ν…μ¤νΈ ν•΄μ•Όν• κΉ?

- λ€μ¤‘μ μΈ λΌμ΄λΈλ¬λ¦¬λ“¤μ„ μ‚¬μ©ν•λ‹¤.
- Unit Test: **React Testing Library** λ“±
- E2E Test: **Cypress** λ“±

### μ™ CypressμΌκΉ?

- Front-end κ°λ° E2E λ¶„μ•Όμ—μ„ κ°€μ¥ λ€μ¤‘μ μ΄κ³  μ•μ •μ μΈ λΌμ΄λΈλ¬λ¦¬μ΄λ‹¤.
- [λ¬Έμ„ν™”](https://docs.cypress.io/)κ°€ μ λμ–΄ μκ³ , μ°Έκ³ ν•  μ μλ” λ νΌλ°μ¤κ°€ λ§λ‹¤.

### E2Eκ°€ λ¬΄μ—‡μΌκΉ?

- **E2E**: End-to-End ν…μ¤νΈλ¥Ό μλ―Έν•λ‹¤.

  |                                               ν”„λ΅μ νΈ ν΄λ”                                               |
  | :-------------------------------------------------------------------------------------------------------: |
  | <img width="500" src="https://github.com/user-attachments/assets/d61ebc08-7157-4660-a402-152a7c20cf0b" /> |

  - **Unit Test**

    ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•λ” λΉ„μ©μ΄ κ°€μ¥ μ‘λ‹¤.

    β‡’ ν…μ¤νΈ μ½”λ“ μ‘μ„±μ— μ‹κ°„μ΄ μ κ² λ“¤κ³  μ‰½κ² μ‘μ„±ν•  μ μλ‹¤.

  - **Integration Test**

    Unit Test λ‡ κ°λ¥Ό μ΅°ν•©ν•μ—¬ ν•λ‚μ κΈ°λ¥μ„ μ κ²€ν•λ” μΈ΅λ©΄μ΄λ‹¤.

  - **End-to-End Test**

    μ„λΉ„μ¤μ μµμΆ… ν’μ§μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ©°, κ°€μ¥ λΉ„μ©μ΄ λ§μ΄ λ“¤μ–΄κ°„λ‹¤.

    β‡’ ν…μ¤νΈ μ½”λ“ μ‘μ„±μ— μ‹κ°„μ΄ λ§μ΄ λ“¤κ³  μ‘μ„±ν•κΈ° μ–΄λ µλ‹¤.

---

## 2. ν…μ¤ν… μ‹¤μµ ν™κ²½ κµ¬μ„±

> **ν™κ²½** : Next.js + Cypress ([κ³µμ‹λ¬Έμ„](https://nextjs.org/docs/app/guides/testing/cypress))

### ν”„λ΅μ νΈμ— cypress μ„¤μΉ

- `devDependencies`μ— cypressλ¥Ό μ„¤μΉν•λ‹¤.

  ```bash
  npm install -D cypress

  # or

  yarn add -D cypress

  # or

  pnpm install -D cypress
  ```

- package.json νμΌμ `scripts`μ— λ‹¤μκ³Ό κ°™μ΄ μ»¤μ¤ν…€ λ…λ Ήμ–΄λ¥Ό μ¶”κ°€ν•λ‹¤.

  ```json
  {
    "scripts": {
      "dev": "next dev",
      "build": "next build",
      "start": "next start",
      "lint": "next lint",
      "cypress:open": "cypress open"
    }
  }
  ```

### cypress μ‹¤ν–‰

- ν„°λ―Έλ„μ—μ„ scriptμ— μ¶”κ°€ν• λ…λ Ήμ–΄λ¥Ό μ…λ ¥ν•΄ cypressλ¥Ό μ‹¤ν–‰ν•λ‹¤.

  ```bash
  npm run cypress:open
  ```

  |                                                   cypress μ‹¤ν–‰ κ²°κ³Ό                                                   |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/d2cf7003-96b0-4fc8-b824-16409b408895" /> |

- **E2E Testingμ„ μ„ νƒ**ν•κ³  ν…μ¤νΈν•  λΈλΌμ°μ €λ¥Ό μ„ νƒν•λ‹¤.

  |                                                     λΈλΌμ°μ € μ„ νƒ                                                     |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/29ef270b-512f-446f-a7b8-6ce3699532d5" /> |

- cypress μ°½μ„ λ‹«κ³  ν”„λ΅μ νΈ ν΄λ”λ΅ λμ•„μ¤λ©΄, cypress ν΄λ”μ™€ cypress μ„¤μ • νμΌμ΄ μƒμ„±λ κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

  |                                                     ν”„λ΅μ νΈ ν΄λ”                                                     |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="150" alt="Image" src="https://github.com/user-attachments/assets/da448202-a32c-41cf-94c9-b25a8305e2fd" /> |

---

## 3. ν…μ¤ν… μ‹μ‘ν•κΈ°

### μ²« λ²μ§Έ ν…μ¤νΈ μ½”λ“ μ‘μ„±

- μƒμ„±λ cypress ν΄λ” μ•μ— **e2e** ν΄λ”λ¥Ό μƒμ„±ν•κ³  μ΄ μ•μ— ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•λ‹¤.

  - νμΌ μ΄λ¦„μ€ `[νμΌ μ΄λ¦„]/cy.js` ν•νƒμ΄λ‹¤.
    - `cy.js`: JavaScriptλ΅ μ‘μ„±λ cypress μ½”λ“λ¥Ό μλ―Έν•λ‹¤.

  <br />

  ```js
  describe("ν™νμ΄μ§€ ν…μ¤νΈ μ½”λ“", () => {
    it('"/"λ΅ μ§„μ…ν•λ©΄ νμ΄μ§€κ°€ μ •μƒμ μΌλ΅ ν‘μ‹λλ‹¤.', () => {
      cy.visit("http://localhost:3000/");
    });
  });
  ```

  - `describe`: ν…μ¤νΈ κ·Έλ£Ή
  - `it`: ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### cypress μ‹¤ν–‰

- cypressλ¥Ό μ‹¤ν–‰ν•λ©΄ cypressκ°€ μ‘μ„±ν• ν…μ¤νΈ νμΌμ„ μΈμ‹ν•λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

  |                                                   cypress μ‹¤ν–‰ κ²°κ³Ό                                                   |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/d672a5c9-12c9-4876-9ae9-e1b12159ac97" /> |

- ν…μ¤νΈ νμΌμ„ μ„ νƒν•λ©΄ λ‹¤μκ³Ό κ°™μ΄ ν…μ¤νΈκ°€ μ •μƒμ μΌλ΅ μ‹¤ν–‰λλ” λ¨μµμ„ ν™•μΈν•  μ μλ‹¤.

  |                                                   ν…μ¤νΈ μ‹¤ν–‰ κ²°κ³Ό                                                    |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/e4338a83-0f94-4f6e-8ece-381c7aa277ac" /> |

### cypress UI

- cypressμ UIλ” λ‹¤μκ³Ό κ°™λ‹¤.

  - Test Bodyμ κ° λ‹¨κ³„μ— λ§μ°μ¤λ¥Ό νΈλ²„ν•λ©΄ κ° λ‹¨κ³„λ³„ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μλ„λ΅ ν™”λ©΄μ„ μ μ–΄ν•λ‹¤.
  - μ°μΈ΅μ—λ” ν…μ¤νΈ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μλ” λ―Έλ¦¬λ³΄κΈ°λ„ μ κ³µν•λ‹¤.
  - Chrome λΈλΌμ°μ €μ—μ„ μ κ³µν•λ” κ°λ°μ λ„κµ¬ μ—­μ‹ μ‚¬μ©ν•  μ μλ‹¤. [command(β) + option(β¥) + i]

  |                                                   ν…μ¤νΈ μ„±κ³µ μ‹ UI                                                   |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/639c3071-f137-4027-9e77-9fa6a8f83a52" /> |

- λ§μ•½ μ—λ¬κ°€ λ°μƒν•λ‹¤λ©΄, cypressλ” μ—λ¬κ°€ λ°μƒν• μ„μΉμ™€ κ·Έ μ΄μ λ¥Ό μ•λ ¤μ¤€λ‹¤.

  |                                                    μ—λ¬ λ°μƒ μ‹ UI                                                    |
  | :-------------------------------------------------------------------------------------------------------------------: |
  | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/25eb7b2f-0a7a-4c78-8231-fc66ac7013a7" /> |

### cypress eslint ν™κ²½ κµ¬μ„±

> **μ°Έκ³ ** : [Cypress ESLint Plugin Github Repository](https://github.com/cypress-io/eslint-plugin-cypress)

- cypress eslint pluginμ„ μ„¤μΉν•λ‹¤.

  > **β οΈ μ¤‘μ”** Cypress ESLint Pluginμ€ ESLint V9 μ΄μƒλ§ μ§€μ›ν•κΈ° λ•λ¬Έμ— μ΄μ „ λ²„μ „μ΄λΌλ©΄ **λ°λ“μ‹** μ—…λ°μ΄νΈκ°€ ν•„μ”ν•λ‹¤.

  ```bash
  npm install eslint eslint-plugin-cypress --save-dev
  ```

- `eslint.config.*js` νμΌμ μƒλ‹¨μ— `pluginCypress`λ¥Ό `import` ν•λ‹¤.

  ```js
  import pluginCypress from 'eslint-plugin-cypress/flat';
  ```

- recommended rulesλ¥Ό μ¶”κ°€ν•κΈ° μ„ν•΄ λ‹¤μ μ½”λ“λ¥Ό `eslint.config.*js` νμΌμ— μ¶”κ°€ν•λ‹¤.

  ```js
  import pluginCypress from 'eslint-plugin-cypress/flat';

  export default [
    ...
    pluginCypress.configs.recommended,
    ...
    {
      rules: {
        'cypress/no-unnecessary-waiting': 'off'
      }
    }
  ]
  ```

---

## 4. λ―Έλ‹ ν”„λ΅μ νΈ

### κ°„λ‹¨ν• Counter μ•± μ μ‘

- ν…μ¤νΈ μ½”λ“ μ‘μ„±μ„ μ„ν•΄ κ°„λ‹¨ν• Counter μ»΄ν¬λ„νΈλ¥Ό μƒμ„±ν•λ‹¤.

  ```jsx
  const Counter = () => {
    const [counter, setCounter] = useState(0);

    const handleIncrease = () => {
      setCounter(counter + 1);
    };

    const handleDecrease = () => {
      setCounter(counter - 1);
    };

    return (
      <div>
        <p>{counter}</p>
        <button type="button" onClick={handleIncrease}>
          +
        </button>
        <button type="button" onClick={handleDecrease}>
          -
        </button>
      </div>
    );
  };
  ```

### μ²« λ²μ§Έ ν…μ¤νΈ μ½”λ“ μ‘μ„±

> π¨ E2E ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•  λ•μ—λ” μ‘μ„±ν• μ½”λ“ κΈ°λ°μ΄ μ•„λ‹λΌ **μ‚¬μ©μ κ΄€μ μ—μ„ μ½”λ“λ¥Ό μ‘μ„±**ν•΄μ•Ό ν•λ‹¤!!
> - μ‚¬μ©μ κ΄€μ μ—μ„ μ‘μ„±λ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤μ— μ§‘μ¤‘ν•λ‹¤.
> - μ½”λ“λ¥Ό λ³΄κ³  μ •μƒμ μΌλ΅ λ™μ‘ν•λ”μ§€ ν™•μΈν•λ” κ²ƒμ΄ **μ•„λ‹λ‹¤**.
> - μ‚¬μ©μκ°€ μ…λ ¥ν•κ³  μΈν„°λ ‰μ… ν–μ„ λ• μ‚¬μ©μκ°€ κΈ°λ€ν•λ” κ²°κ³Όλ¥Ό ν…μ¤νΈ μ½”λ“λ΅ ν’€μ–΄λ‚΄λ” κ²ƒμ΄λ‹¤.
> - μ΄ μ‹λ®¬λ μ΄μ…μ„ μλ™ν™”ν•¨μΌλ΅μ¨ **"μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ λ™μ‘ν•λ”μ§€ μ—¬λ¬ λ…μ μ‚¬μ©μκ°€ ν™•μΈν•λ‹¤"**λ” κ΄€μ μ—μ„ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•΄μ•Ό ν•λ‹¤.

<br />

- **cypress/e2e** ν΄λ” λ‚΄λ¶€μ— `counter.cy.js`λΌλ” μ΄λ¦„μ ν…μ¤νΈ νμΌμ„ μƒμ„±ν•λ‹¤.

- ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•λ‹¤.

  β‘  ν…μ¤νΈλ¥Ό μ„ν•΄ DOM μ”μ†(Element)λ΅ μ ‘κ·Όν•΄μ•Ό ν•λ”λ°, μ–΄λ–¤ DOM μ”μ†μΈμ§€ λ…ν™•ν ν•κΈ° μ„ν•΄ `data-cy`λΌλ” ν…μ¤νΈμ© IDλ¥Ό λ¶€μ—¬ν•λ‹¤.

  ```jsx
  <p data-cy="counter">{counter}</p>
  ```

  β‘΅ `cy.get()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ DOM μ”μ†λ¥Ό λ¶λ¬μ¨λ‹¤.

  - `cy.get(selector)`: νμ΄μ§€μ— μλ” μ”μ†λ¥Ό λ¶λ¬μ¤λ” cypress λ©”μ„λ“

    |                                                      `cy.get()`                                                       |
    | :-------------------------------------------------------------------------------------------------------------------: |
    | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/0cf3b338-cd1d-4c25-8e95-6b68a4f0488c" /> |

  - `data-cy`κ°€ `counter`μΈ μ”μ†λ¥Ό λ¶λ¬μ™€μ„ ν•΄λ‹Ή μ”μ†κ°€ `0`μ„ κ°€μ§€κ³  μλ”μ§€ ν™•μΈν•λ‹¤.

    ```js
    cy.get('[data-cy=counter]').contains(0);
    ```

  - μ „μ²΄ ν…μ¤νΈ μ½”λ“λ” λ‹¤μκ³Ό κ°™λ‹¤.

    ```js
    describe('Counter μ•±', () => {
      // μ²« λ²μ§Έ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ - λ°μ΄ν„°κ°€ μ •μƒμ μΌλ΅ ν‘μ‹λμ—λ”μ§€
      it('νμ΄μ§€μ— μ§„μ…ν•λ©΄ Counter μ•±μ΄ μ •μƒμ μΌλ΅ μ‹¤ν–‰λλ‹¤: 0μ΄ ν‘μ‹λλ‹¤.', () => {
        cy.visit('http://localhost:3000');

        // νμ΄μ§€μ— μλ” μ”μ†λ¥Ό λ¶λ¬μ¤λ” cypress λ©”μ„λ“
        cy.get('[data-cy=counter]').contains(0);
      });
    });
    ```

    |                                                   ν…μ¤νΈ μ‹¤ν–‰ κ²°κ³Ό                                                    |
    | :-------------------------------------------------------------------------------------------------------------------: |
    | <img width="500" alt="Image" src="https://github.com/user-attachments/assets/e433abe7-cd50-48d6-924b-3494240a54f5" /> |

### λ‘ λ²μ§Έ ν…μ¤νΈ μ½”λ“ μ‘μ„±

- λ²„νΌ λ™μ‘μ„ ν…μ¤νΈν•κΈ° μ„ν• ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•λ‹¤.

  β‘  `counter` μ”μ†μ™€ λ§μ°¬κ°€μ§€λ΅, λ²„νΌμ—λ„ `data-cy`λΌλ” cypressλ¥Ό μ„ν• ν…μ¤νΈμ© IDλ¥Ό λ¶€μ—¬ν•λ‹¤.

  - λ¬Όλ΅  κΈ°μ΅΄μ `id` μ†μ„±μ„ μ΄μ©ν•΄λ„ λ™μΌν•κ² λ™μ‘ν•μ§€λ§, λΉ„μ¦λ‹μ¤ λ΅μ§κ³Όλ„ κ²ΉμΉ  μ μκΈ° λ•λ¬Έμ— ν…μ¤νΈ μ½”λ“ μ „μ© IDλ¥Ό λ¶€μ—¬ν•λ” κ²ƒμ΄ κ³µμ‹λ¬Έμ„μ—μ„ μ μ‹ν•λ” Best-Practiceμ΄λ‹¤.

    ```jsx
    <button type="button" data-cy="plus-button" onClick={handleIncrease}>
      +
    </button>
    <button type="button" data-cy="minus-button" onClick={handleDecrease}>
      -
    </button>
    ```

  β‘΅ `cy.click()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ”μ†μ ν΄λ¦­μ„ μ‹λ®¬λ μ΄μ… ν•λ‹¤.

  - `cy.click()`: νμ΄μ§€μ— μλ” μ”μ†μ ν΄λ¦­μ„ μ‹λ®¬λ μ΄μ… ν•λ” cypress λ©”μ„λ“

    |                                                     `cy.click()`                                                      |
    | :-------------------------------------------------------------------------------------------------------------------: |
    | <img width="500" alt="image" src="https://github.com/user-attachments/assets/e6345984-970d-47bf-a7b3-1f76798b7426" /> |

  - `data-cy`κ°€ `plus-button`μΈ μ”μ†λ¥Ό λ¶λ¬μ™€μ„ μ”μ†μ ν΄λ¦­μ„ μ‹λ®¬λ μ΄μ… ν•λ‹¤.

    ```js
    cy.get('[data-cy=plus-button]').click();
    ```

  - `counter` μ”μ†μ λ°μ΄ν„°κ°€ `1` μ¦κ°€ν–λ”μ§€ ν™•μΈν•λ‹¤.

    ```js
    cy.get('[data-cy=counter]').contains(1);
    ```

  - μ „μ²΄ ν…μ¤νΈ μ½”λ“λ” λ‹¤μκ³Ό κ°™λ‹¤. λ§μ΄λ„μ¤ λ²„νΌμ μ‹λ‚λ¦¬μ¤λ„ ν”λ¬μ¤ λ²„νΌκ³Ό λ™μΌν•λ‹¤.

    ```js
    // λ‘ λ²μ§Έ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ - ν”λ¬μ¤ λ²„νΌμ„ λ„λ¥΄λ©΄ λ°μ΄ν„°κ°€ μ¦κ°€ν•λ”μ§€
    it('ν”λ¬μ¤ λ²„νΌμ„ λ„λ¥΄λ©΄ counterκ°€ 1 μ¦κ°€ν•λ‹¤.', () => {
      cy.visit('http://localhost:3000');

      // μ”μ† ν΄λ¦­μ„ μ‹λ®¬λ μ΄μ… ν•λ” cypress λ©”μ„λ“
      cy.get('[data-cy=plus-button]').click();
      cy.get('[data-cy=counter]').contains(1);
    });

    // μ„Έ λ²μ§Έ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ - λ§μ΄λ„μ¤ λ²„νΌμ„ λ„λ¥΄λ©΄ λ°μ΄ν„°κ°€ κ°μ†ν•λ”μ§€
    it('λ§μ΄λ„μ¤ λ²„νΌμ„ λ„λ¥΄λ©΄ counterκ°€ 1 κ°μ†ν•λ‹¤.', () => {
      cy.visit('http://localhost:3000');

      // μ”μ† ν΄λ¦­μ„ μ‹λ®¬λ μ΄μ… ν•λ” cypress λ©”μ„λ“
      cy.get('[data-cy=minus-button]').click();
      cy.get('[data-cy=counter]').contains(-1);
    });
    ```

    |                                                   ν…μ¤νΈ μ‹¤ν–‰ κ²°κ³Ό                                                    |
    | :-------------------------------------------------------------------------------------------------------------------: |
    | <img width="500" alt="image" src="https://github.com/user-attachments/assets/0133dabb-84e2-4241-9adb-5296a939880c" /> |

